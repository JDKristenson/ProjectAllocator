<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.project_name }} - Team Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --bg-primary: #08090A;
            --bg-secondary: #0f1011;
            --bg-tertiary: #16171a;
            --bg-hover: #1c1d21;
            --border: #26272b;
            --border-light: #36373b;
            --text-primary: #f7f8f8;
            --text-secondary: #A1A7C1;
            --text-tertiary: #6b6f82;
            --accent: #5E6AD2;
            --accent-hover: #7c85e0;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #f87171;
            --radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-primary);
            background: var(--bg-primary);
            -webkit-font-smoothing: antialiased;
        }

        .layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 16px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 16px 16px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px;
        }

        .sidebar-header h1 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .sidebar-header .meta {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .nav-section {
            padding: 8px 0;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 16px 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 6px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            cursor: pointer;
            transition: all 0.1s;
        }

        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-icon {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            opacity: 0.7;
        }

        .nav-badge {
            margin-left: auto;
            font-size: 11px;
            padding: 1px 6px;
            border-radius: 10px;
            background: var(--bg-tertiary);
            color: var(--text-tertiary);
        }

        .nav-badge.danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .nav-badge.warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        /* Main content */
        .main {
            flex: 1;
            margin-left: 240px;
            min-height: 100vh;
        }

        .topbar {
            height: 48px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 24px;
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .topbar-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .topbar-meta {
            margin-left: auto;
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .content {
            padding: 24px;
            max-width: 1200px;
        }

        /* Section */
        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-count {
            margin-left: 8px;
            font-size: 11px;
            color: var(--text-tertiary);
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .card-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .card-body {
            padding: 16px;
        }

        /* Grid */
        .grid {
            display: grid;
            gap: 16px;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-auto {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        /* Work stream cards */
        .ws-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            transition: border-color 0.1s;
        }

        .ws-card:hover {
            border-color: var(--border-light);
        }

        .ws-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .ws-card-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .ws-card-priority {
            margin-left: auto;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ws-card-priority.high {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .ws-members {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .member-chip {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            font-size: 12px;
            color: var(--text-primary);
        }

        .member-chip.primary {
            background: var(--accent);
            color: white;
        }

        .member-chip.secondary {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .no-match {
            font-size: 12px;
            color: var(--text-tertiary);
            font-style: italic;
        }

        /* Tags */
        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            margin: 2px;
        }

        .tag.success {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }

        .tag.warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .tag.danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        /* Team member row */
        .member-row {
            display: flex;
            align-items: flex-start;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            transition: background 0.1s;
        }

        .member-row:last-child {
            border-bottom: none;
        }

        .member-row:hover {
            background: var(--bg-hover);
        }

        .member-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .member-info {
            flex: 1;
            min-width: 0;
        }

        .member-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .member-role {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .member-skills {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .member-meta {
            text-align: right;
            flex-shrink: 0;
        }

        .member-exp {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Gap analysis */
        .gap-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .gap-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
        }

        .gap-card-title {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .gap-card-title .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .gap-card-title .dot.danger {
            background: var(--danger);
        }

        .gap-card-title .dot.warning {
            background: var(--warning);
        }

        .gap-card-title .dot.success {
            background: var(--success);
        }

        .gap-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .empty-state {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Chart container */
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }

        /* Plotly dark theme overrides */
        .js-plotly-plot .plotly .modebar {
            background: transparent !important;
        }

        .js-plotly-plot .plotly .modebar-btn path {
            fill: var(--text-tertiary) !important;
        }

        /* Stats row */
        .stats-row {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                display: none;
            }
            .main {
                margin-left: 0;
            }
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            .gap-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>{{ project.project_name }}</h1>
                <div class="meta">{{ generated_at }}</div>
            </div>

            <nav class="nav-section">
                <div class="nav-label">Overview</div>
                <a href="#matrix" class="nav-item active">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                    </svg>
                    Skills Matrix
                </a>
                <a href="#assignments" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    Assignments
                    <span class="nav-badge">{{ project.work_streams|length }}</span>
                </a>
            </nav>

            <nav class="nav-section">
                <div class="nav-label">Analysis</div>
                <a href="#gaps" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    Skill Gaps
                    {% if gap_analysis.uncovered_skills %}
                    <span class="nav-badge danger">{{ gap_analysis.uncovered_skills|length }}</span>
                    {% endif %}
                </a>
                <a href="#risks" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Single Points
                    {% if gap_analysis.partially_covered %}
                    <span class="nav-badge warning">{{ gap_analysis.partially_covered|length }}</span>
                    {% endif %}
                </a>
            </nav>

            <nav class="nav-section">
                <div class="nav-label">Team</div>
                {% for member in team_members %}
                <a href="#team" class="nav-item">
                    <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    {{ member.name }}
                </a>
                {% endfor %}
            </nav>
        </aside>

        <!-- Main content -->
        <main class="main">
            <header class="topbar">
                <span class="topbar-title">Team Analysis Report</span>
                <span class="topbar-meta">{{ team_members|length }} members Â· {{ project.work_streams|length }} work streams</span>
            </header>

            <div class="content">
                <!-- Stats -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value">{{ team_members|length }}</div>
                        <div class="stat-label">Team Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ project.work_streams|length }}</div>
                        <div class="stat-label">Work Streams</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--danger);">{{ gap_analysis.uncovered_skills|length }}</div>
                        <div class="stat-label">Uncovered Skills</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: var(--warning);">{{ gap_analysis.partially_covered|length }}</div>
                        <div class="stat-label">Single Coverage</div>
                    </div>
                </div>

                <!-- Skills Matrix -->
                <section id="matrix" class="section">
                    <div class="section-header">
                        <h2 class="section-title">Skills Matrix</h2>
                    </div>
                    <div class="chart-container">
                        {{ heatmap_html | safe }}
                    </div>
                </section>

                <!-- Recommended Assignments -->
                <section id="assignments" class="section">
                    <div class="section-header">
                        <h2 class="section-title">Recommended Assignments</h2>
                        <span class="section-count">{{ project.work_streams|length }} streams</span>
                    </div>
                    <div class="grid grid-auto">
                        {% for ws in project.work_streams %}
                        <div class="ws-card">
                            <div class="ws-card-header">
                                <span class="ws-card-title">{{ ws.name }}</span>
                                {% if ws.priority == 'high' %}
                                <span class="ws-card-priority high">High</span>
                                {% endif %}
                            </div>
                            <div class="ws-members">
                                {% set members = recommendations.get(ws.name, []) %}
                                {% if members %}
                                    {% for member in members %}
                                    <span class="member-chip {% if loop.first %}primary{% else %}secondary{% endif %}">{{ member }}</span>
                                    {% endfor %}
                                {% else %}
                                    <span class="no-match">No strong matches</span>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>

                <!-- Gap Analysis -->
                <section id="gaps" class="section">
                    <div class="section-header">
                        <h2 class="section-title">Skill Gap Analysis</h2>
                    </div>
                    <div class="gap-section">
                        <div class="gap-card">
                            <div class="gap-card-title">
                                <span class="dot danger"></span>
                                Uncovered Skills
                            </div>
                            {% if gap_analysis.uncovered_skills %}
                            <div class="gap-list">
                                {% for skill in gap_analysis.uncovered_skills %}
                                <span class="tag danger">{{ skill }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="empty-state">All required skills are covered</div>
                            {% endif %}
                        </div>
                        <div class="gap-card" id="risks">
                            <div class="gap-card-title">
                                <span class="dot warning"></span>
                                Single Point of Failure
                            </div>
                            {% if gap_analysis.partially_covered %}
                            <div class="gap-list">
                                {% for skill in gap_analysis.partially_covered %}
                                <span class="tag warning">{{ skill }}</span>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="empty-state">No single-person dependencies</div>
                            {% endif %}
                        </div>
                    </div>
                </section>

                <!-- Team -->
                <section id="team" class="section">
                    <div class="section-header">
                        <h2 class="section-title">Team</h2>
                        <span class="section-count">{{ team_members|length }} members</span>
                    </div>
                    <div class="card">
                        {% for member in team_members %}
                        <div class="member-row">
                            <div class="member-avatar">{{ member.name[0] }}</div>
                            <div class="member-info">
                                <div class="member-name">{{ member.name }}</div>
                                <div class="member-role">{{ member.current_role }}</div>
                                <div class="member-skills">
                                    {% for skill in member.skills[:6] %}
                                    <span class="tag">{{ skill }}</span>
                                    {% endfor %}
                                    {% if member.skills|length > 6 %}
                                    <span class="tag">+{{ member.skills|length - 6 }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="member-meta">
                                <div class="member-exp">{{ member.experience_years }} yrs exp</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>

                <!-- Additional Capabilities -->
                {% if gap_analysis.team_strengths %}
                <section class="section">
                    <div class="section-header">
                        <h2 class="section-title">Additional Capabilities</h2>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="gap-list">
                                {% for skill in gap_analysis.team_strengths %}
                                <span class="tag success">{{ skill }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </section>
                {% endif %}
            </div>
        </main>
    </div>

    <script>
        // Update Plotly charts to dark theme
        document.addEventListener('DOMContentLoaded', function() {
            const plots = document.querySelectorAll('.js-plotly-plot');
            plots.forEach(plot => {
                if (plot.data) {
                    Plotly.relayout(plot, {
                        paper_bgcolor: '#111113',
                        plot_bgcolor: '#111113',
                        font: { color: '#a1a1aa', size: 11 },
                        xaxis: { gridcolor: '#27272a', linecolor: '#27272a' },
                        yaxis: { gridcolor: '#27272a', linecolor: '#27272a' }
                    });
                }
            });
        });

        // Smooth scroll for nav links
        document.querySelectorAll('.nav-item').forEach(link => {
            link.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href && href.startsWith('#')) {
                    e.preventDefault();
                    document.querySelector(href)?.scrollIntoView({ behavior: 'smooth' });
                    document.querySelectorAll('.nav-item').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
